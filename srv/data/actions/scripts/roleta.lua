local actionid = {
------------------ROLETA 1 ----------------------------
[7001] =  {storage2 = 7011,
poss = {
[1] = {x = 2606, y = 1855, z = 7, stackpos=2},  --- Posiçoes dos itens
[2] = {x = 2607, y = 1855, z = 7, stackpos=2},
[3] = {x = 2608, y = 1855, z = 7, stackpos=2},
[4] = {x = 2609, y = 1855, z = 7, stackpos=2},
[5] = {x = 2610, y = 1855, z = 7, stackpos=2},
[6] = {x = 2610, y = 1854, z = 7, stackpos=2},
[7] = {x = 2610, y = 1853, z = 7, stackpos=2},
[8] = {x = 2609, y = 1853, z = 7, stackpos=2},
[9] = {x = 2608, y = 1853, z = 7, stackpos=2},
[10] = {x = 2607, y = 1853, z = 7, stackpos=2},
[11] = {x = 2606, y = 1853, z = 7, stackpos=2},
[12] = {x = 2605, y = 1853, z = 7, stackpos=2},
[13] = {x = 2604, y = 1853, z = 7, stackpos=2},
[14] = {x = 2603, y = 1853, z = 7, stackpos=2},
[15] = {x = 2602, y = 1853, z = 7, stackpos=2},
[16] = {x = 2602, y = 1854, z = 7, stackpos=2},
[17] = {x = 2602, y = 1855, z = 7, stackpos=2},
[18] = {x = 2603, y = 1855, z = 7, stackpos=2},
[19] = {x = 2604, y = 1855, z = 7, stackpos=2},
[20] = {x = 2605, y = 1855, z = 7, stackpos=2}}},

------------------ROLETA 2 ----------------------------
 
[7002] = {storage2 = 7012,
poss = {
[1] = {x = 2622, y = 1855, z = 7, stackpos=2},
[2] = {x = 2623, y = 1855, z = 7, stackpos=2},
[3] = {x = 2624, y = 1855, z = 7, stackpos=2},
[4] = {x = 2625, y = 1855, z = 7, stackpos=2},
[5] = {x = 2626, y = 1855, z = 7, stackpos=2},
[6] = {x = 2626, y = 1854, z = 7, stackpos=2},
[7] = {x = 2626, y = 1853, z = 7, stackpos=2},
[8] = {x = 2625, y = 1853, z = 7, stackpos=2},
[9] = {x = 2624, y = 1853, z = 7, stackpos=2},
[10] = {x = 2623, y = 1853, z = 7, stackpos=2},
[11] = {x = 2622, y = 1853, z = 7, stackpos=2},
[12] = {x = 2621, y = 1853, z = 7, stackpos=2},
[13] = {x = 2620, y = 1853, z = 7, stackpos=2},
[14] = {x = 2619, y = 1853, z = 7, stackpos=2},
[15] = {x = 2618, y = 1853, z = 7, stackpos=2},
[16] = {x = 2618, y = 1854, z = 7, stackpos=2},
[17] = {x = 2618, y = 1855, z = 7, stackpos=2},
[18] = {x = 2619, y = 1855, z = 7, stackpos=2},
[19] = {x = 2620, y = 1855, z = 7, stackpos=2},
[20] = {x = 2621, y = 1855, z = 7, stackpos=2}}},

------------------ROLETA 3 ----------------------------

[7003] = {storage2 = 7013,
poss = {
[1] = {x= 2637, y=1855, z= 7, stackpos=2},
[2] = {x= 2638, y=1855, z= 7, stackpos=2},
[3] = {x= 2639, y=1855, z= 7, stackpos=2},
[4] = {x= 2640, y=1855, z= 7, stackpos=2},
[5] = {x= 2641, y=1855, z= 7, stackpos=2},
[6] = {x= 2641, y=1854, z= 7, stackpos=2},
[7] = {x= 2641, y=1853, z= 7, stackpos=2},
[8] = {x= 2640, y=1853, z= 7, stackpos=2},
[9] = {x= 2639, y=1853, z= 7, stackpos=2},
[10] = {x= 2638, y=1853, z= 7, stackpos=2},
[11] = {x= 2637, y=1853, z= 7, stackpos=2},
[12] = {x= 2636, y=1853, z= 7, stackpos=2},
[13] = {x= 2635, y=1853, z= 7, stackpos=2},
[14] = {x= 2634, y=1853, z= 7, stackpos=2},
[15] = {x= 2633, y=1853, z= 7, stackpos=2},
[16] = {x= 2633, y=1854, z= 7, stackpos=2},
[17] = {x= 2633, y=1855, z= 7, stackpos=2},
[18] = {x= 2634, y=1855, z= 7, stackpos=2},
[19] = {x= 2635, y=1855, z= 7, stackpos=2},
[20] = {x= 2636, y=1855, z= 7, stackpos=2}}},

------------------ROLETA 4 ----------------------------

[7004] = {storage2 = 7014,
poss = {
[1] = {x= 2606, y=1868, z= 7, stackpos=2},
[2] = {x= 2605, y=1868, z= 7, stackpos=2},
[3] = {x= 2604, y=1868, z= 7, stackpos=2},
[4] = {x= 2603, y=1868, z= 7, stackpos=2},
[5] = {x= 2602, y=1868, z= 7, stackpos=2},
[6] = {x= 2602, y=1869, z= 7, stackpos=2},
[7] = {x= 2602, y=1870, z= 7, stackpos=2},
[8] = {x= 2603, y=1870, z= 7, stackpos=2},
[9] = {x= 2604, y=1870, z= 7, stackpos=2},
[10] = {x= 2605, y=1870, z= 7, stackpos=2},
[11] = {x= 2606, y=1870, z= 7, stackpos=2},
[12] = {x= 2607, y=1870, z= 7, stackpos=2},
[13] = {x= 2608, y=1870, z= 7, stackpos=2},
[14] = {x= 2609, y=1870, z= 7, stackpos=2},
[15] = {x= 2610, y=1870, z= 7, stackpos=2},
[16] = {x= 2610, y=1869, z= 7, stackpos=2},
[17] = {x= 2610, y=1868, z= 7, stackpos=2},
[18] = {x= 2609, y=1868, z= 7, stackpos=2},
[19] = {x= 2608, y=1868, z= 7, stackpos=2},
[20] = {x= 2607, y=1868, z= 7, stackpos=2}}},
------------------ROLETA 5 ----------------------------

[7005] = {storage2 = 7015,
poss = {
[1] = {x= 2622, y=1868, z= 7, stackpos=2},
[2] = {x= 2621, y=1868, z= 7, stackpos=2},
[3] = {x= 2620, y=1868, z= 7, stackpos=2},
[4] = {x= 2619, y=1868, z= 7, stackpos=2},
[5] = {x= 2618, y=1868, z= 7, stackpos=2},
[6] = {x= 2618, y=1869, z= 7, stackpos=2},
[7] = {x= 2618, y=1870, z= 7, stackpos=2},
[8] = {x= 2619, y=1870, z= 7, stackpos=2},
[9] = {x= 2620, y=1870, z= 7, stackpos=2},
[10] = {x= 2621, y=1870, z= 7, stackpos=2},
[11] = {x= 2622, y=1870, z= 7, stackpos=2},
[12] = {x= 2623, y=1870, z= 7, stackpos=2},
[13] = {x= 2624, y=1870, z= 7, stackpos=2},
[14] = {x= 2625, y=1870, z= 7, stackpos=2},
[15] = {x= 2626, y=1870, z= 7, stackpos=2},
[16] = {x= 2626, y=1869, z= 7, stackpos=2},
[17] = {x= 2626, y=1868, z= 7, stackpos=2},
[18] = {x= 2625, y=1868, z= 7, stackpos=2},
[19] = {x= 2624, y=1868, z= 7, stackpos=2},
[20] = {x= 2623, y=1868, z= 7, stackpos=2}}},

------------------ROLETA 6 ----------------------------

[7006] = {storage2 = 7016,
poss = {
[1] = {x= 2637, y=1868, z= 7, stackpos=2},
[2] = {x= 2636, y=1868, z= 7, stackpos=2},
[3] = {x= 2635, y=1868, z= 7, stackpos=2},
[4] = {x= 2634, y=1868, z= 7, stackpos=2},
[5] = {x= 2633, y=1868, z= 7, stackpos=2},
[6] = {x= 2633, y=1869, z= 7, stackpos=2},
[7] = {x= 2633, y=1870, z= 7, stackpos=2},
[8] = {x= 2634, y=1870, z= 7, stackpos=2},
[9] = {x= 2635, y=1870, z= 7, stackpos=2},
[10] = {x= 2636, y=1870, z= 7, stackpos=2},
[11] = {x= 2637, y=1870, z= 7, stackpos=2},
[12] = {x= 2638, y=1870, z= 7, stackpos=2},
[13] = {x= 2639, y=1870, z= 7, stackpos=2},
[14] = {x= 2640, y=1870, z= 7, stackpos=2},
[15] = {x= 2641, y=1870, z= 7, stackpos=2},
[16] = {x= 2641, y=1869, z= 7, stackpos=2},
[17] = {x= 2641, y=1868, z= 7, stackpos=2},
[18] = {x= 2640, y=1868, z= 7, stackpos=2},
[19] = {x= 2639, y=1868, z= 7, stackpos=2},
[20] = {x= 2638, y=1868, z= 7, stackpos=2}}},

}


ITEMS_COMUNS = {2495,11073,11678,7463,2486,10423,10708,10381,10415,10412,12445,11677,10496,11162,12442,12315,10402,7381,12301,2122,11679,12254,12294,2160,10364,13925,6500,7427,10378,11155,5904,10712,10365}
ITEMS_RAROS = {10494}
ITEMS_EXTRARAROS = {10449}
ITEMS_CAGADOS = {8852}

---- Caso o item for stackavel , adicionar tambem nesta tabela a quantidade dejesada se o item for sorteado
local stackaveis = {
[2160] = 50,
[13925] = 20,
[10364] = 50,
[11155] = 25,
[5904] = 15,
[10712] = 25,
[10365] = 50,
[6500] = 25,
}


percents = {
	[{1, 50}] = ITEMS_CAGADOS, -- 0.5%
	[{51, 200}] = ITEMS_EXTRARAROS,  -- 1.5%
	[{201, 1000}] = ITEMS_RAROS,  -- 8%
	[{1001, 10000}] = ITEMS_COMUNS, -- 90%
}



local vales = {
[2122] = 1,
[10541] = 2
}


local cooldown = 1 ---- Exhaust para evitar bug

local file = "data/logs/Roleta.txt"   ----- Arquivo para armazenar ganhadores/premios
local effGiro = 769
local effReward = 769
local effReward2 = 744
local EffCreatRemove= 10




---------------------------------------NAO MEXER---------------------------------------
---------------------------------------------------------------------------------------
----------------------------- SISTEMA ROLETA BY JEANFERSON ----------------------------
---------------------------------------------------------------------------------------
---------------------------------------------------------------------------------------

function onUse(cid, item, fromPosition, itemEx, toPosition)


local positions = actionid[getItemAttribute(item.uid, "aid")].poss
local storage = actionid[getItemAttribute(item.uid, "aid")]
local storage2 = actionid[getItemAttribute(item.uid, "aid")].storage2
local squares = #positions
local min,max = squares*3,squares*5
local voltas = math.random(min,max)
local i = 1
local text = io.open(file, "a+")
local r = squares
local j = {}
local t = 1


function getTable(value)
for v , d in pairs(percents) do
		if value >= v[1] and value <= v[2] then
			return d
		end
	end
end

local function CriarItens()
repeat
doSendMagicEffect(positions[t], EffCreatRemove)
local chance = math.random(1,10000)
local p = getTable(chance)[math.random(1,#getTable(chance))]
if RareSystem(p) then
p = doRandomItem(p)
end
local items = doCreateItemEx(p, 1)
doTileAddItemEx(positions[t], items)
table.insert(j, p)
t = t + 1
until (t > squares)
end

			
local function RemoveItens(posx)
repeat
local pos = positions[r]
local n = getTileThingByPos(pos)
if isInArray(j, n.itemid) then
doSendMagicEffect(pos, EffCreatRemove)
if r == squares then
if isCreature(cid) then
doSendMagicEffect(getThingPos(cid), effReward2)
doCreatureSetNoMove(cid, 0)
end
end
doRemoveItem(n.uid, 1)
end
r = r - 1
if r == 0 then
setGlobalStorageValue(storage2, cooldown + os.time())
setGlobalStorageValue(storage, 0)
end
until (r == 0)
end

local function Rward(posx)
local n = getTileThingByPos(posx)
if isInArray(j, n.itemid) then
if isCreature(cid) then
local quantidadestack = stackaveis[n.itemid]
if quantidadestack then
doPlayerAddItem(cid, n.itemid, quantidadestack)
doBroadcastMessage("[Roleta System]\nO player "..getCreatureName(cid).." ganhou "..quantidadestack.." "..getItemNameById(n.itemid).."s, Parabens!")
doPlayerSendTextMessage(cid, 19,"[Roleta System] Seu premio foi "..quantidadestack.." "..getItemNameById(n.itemid).."s, Parabens!")
text:write("["..os.date("%d/%m/%Y %X", os.time()).."] O jogador "..getPlayerName(cid).." ["..getPlayerLevel(cid).."] ganhou "..quantidadestack.." "..getItemNameById(n.itemid)..".\n")
else
doPlayerAddItem(cid, n.itemid)
doBroadcastMessage("[Roleta System]\nO player "..getCreatureName(cid).." ganhou 1 "..getItemNameById(n.itemid)..", Parabens!")
doPlayerSendTextMessage(cid, 19,"[Roleta System] Seu premio foi 1 "..getItemNameById(n.itemid)..", Parabens!")
text:write("["..os.date("%d/%m/%Y %X", os.time()).."] O jogador "..getPlayerName(cid).." ["..getPlayerLevel(cid).."] ganhou 1 "..getItemNameById(n.itemid)..".\n")
end
end
end
end


local function Multivolta(voltasquant) 
if voltasquant <= squares then
ponto = voltasquant
elseif voltasquant > squares and voltasquant <= squares*2 then
ponto = voltasquant - squares
elseif voltasquant > squares*2 and voltasquant <= squares*3 then
ponto = voltasquant - squares*2
elseif voltasquant > squares*3 and voltasquant <= squares*4 then
ponto = voltasquant - squares*3
elseif voltasquant > squares*4 and voltasquant <= squares*5 then
ponto = voltasquant - squares*4
end
return ponto
end


local function Girar(Rewards, second)
if i <= voltas+1 then
local pos = positions[Multivolta(i)]
doSendMagicEffect(pos, effGiro)
----
if Rewards == 2 and i <= second then
addEvent(doSendMagicEffect, 300, pos, 857)
if i == second then
doSendMagicEffect( pos, 768)
for effects = 1, 10 do
addEvent(doSendMagicEffect, effects* 200, pos, 857)
if effects == 10 then
addEvent(Rward, 1500, pos)
end
end
end
end
----
----
if i == voltas+1 then
doSendMagicEffect( pos, 768)
for effect = 1, 10 do
addEvent(doSendMagicEffect, effect* 100, pos, effReward)
if effect == 10 then
addEvent(Rward, 1900, pos)
addEvent(RemoveItens, 2200, pos)
end
end
end
----
i = i + 1
addEvent(Girar, (i*2)+40,Rewards, second)
end
end

-- local function Girar()
-- while (i <= voltas+1) do
-- local pos = positions[Multivolta(i)]
-- addEvent(doSendMagicEffect, (i*2)+40,pos, effGiro)
-- if i == voltas+1 then
-- for effect = 1, 10 do
-- addEvent(doSendMagicEffect, effect* 100, pos, effReward)
-- if effect == 10 then
-- addEvent(RemoveItens, 2000, pos)
-- end
-- end
-- end
-- i = i + 1
-- end
-- end

-- if getGlobalStorageValue(storage2) - os.time() <= 0 and getGlobalStorageValue(storage) <= 0 then
if getPlayerSlotItem(cid, CONST_SLOT_AMMO).uid and vales[getPlayerSlotItem(cid, CONST_SLOT_AMMO).itemid] then 
CriarItens()
addEvent(Girar, 1000, vales[getPlayerSlotItem(cid, CONST_SLOT_AMMO).itemid], (voltas+1 - (math.random(8,squares*2))))
doRemoveItem(getPlayerSlotItem(cid, CONST_SLOT_AMMO).uid,1)
setGlobalStorageValue(storage, 1)
doCreatureSetNoMove(cid, 1)
else
doPlayerSendCancel(cid, "Para girar a roleta você precisa de um vale roleta (caso tenha, coloque-o no Slot que possui uma Shuriken).")
end
-- else
-- doPlayerSendCancel(cid, "A roleta ja foi ativada, aguarde até que o premio seja escolhido")
-- end


return true
end
