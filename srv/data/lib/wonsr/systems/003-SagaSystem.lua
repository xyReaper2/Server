SAGASYSTEM = {}

SAGASYSTEM.HISTORY = {
[-1] = {capitulo = "Beginning of a journey", 
       mensagem = {
	   "Talk to Iruka Sensei at Shinobi Academy to help you on your ninja path"
       }},
	   
[0] = {capitulo = "Beginning of a journey", elo = 1,
       mensagem = {
	   "Talk to Iruka Sensei at Shinobi Academy to help you on your ninja path."
       }},
	   
[1] = {capitulo = "A traitor in konoha", elo = 9,
       mensagem = {
	   "Mizuki awaits you in front of the Hokage building, don't delay!;",
       "Enter the Hokage building inside her room and look for the forbidden scroll and get it;",
	   "Escape to the forest from the south gate of konoha;",
	   "Talk to the mizuki and defeat him;",
	   "Talk to Iruka Sensei, your path to a gennin is near."
	   }}, 


[2] = {capitulo = "Training with Kakashi", elo = 10,
       mensagem = {
	   "Kakashi awaits you at the southern gate of Konoha to start your training, don't be late !!;",
	   "Escape from Kakashi's vision, hide behind bushes;",
	   "Prepare to ambush him, hide behind a tree;",
	   "Defeat Kakashi."
	   }},
	   
[3] = {capitulo = "The ninja of the hidden fog", elo = 10,
       mensagem = {
	   "Talk to the III Hokage at the top of the Hokage building;",
	   "Find and talk to Tazuna (builder), he is waiting for you on the bridge that leads to Kirigakure No Sato;",
	   "Defeat Haku, you will find him following the path across the bridge;",
	   "Defeat Zabuza."
	   }},
[4] = {capitulo = "Exame Chunin", elo = 25,
       mensagem = {
	   "Talk to Ibiki Morino at Academia Shinoi, he will assist you for the Chunin exam;",
	   "Talk to Anko at the entrance to the Chunin Exam area;",
	   "Proceed through the forest of death;",
	   "Fight orochimaru;",
	   "Defeat the teams and collect the 2 scrolls (sun and moon);",
	   "Find the Examiner in the Chunin Exam area, prepare for elimination;",
	   "Defeat all opponents;",
	   "Give the certificate to the Third Hokage."
       }},	   

[5] = {capitulo = "Gaara is a threat", elo = 15,
       mensagem = {
	   "Talk to Kakashi, he is waiting for you at the southern gate of Konoha;",
	   "Find and Defeat Temari, they were spotted following a path south of the road leading to south forest;",
	   "Find and Defeat Kankuro;",
	   "Find and Defeat Gaara, was spotted in south forest."
	   }},
	   
[6] = {capitulo = "Lendarios Sannins", elo = 25,
       mensagem = {
	   "Talk to the Jiraya who is in the vicinity of the konoha dp;",
	   "Tsunade is currently out of konoha, look for her and help her with whatever she needs;",
	   "Help Tsunade to defeat kabuto;",
	   "Help Tsunade to defeat Orochimaru."
	   }},
	   
[7] = {capitulo = "Battle against Sasuke", elo = 15,
       mensagem = {
	   "Talk to Sasuke at Konoha Hospital;",
	   "defeat Sasuke."
	   }},
	   
[8] = {capitulo = "Sasuke Rescue", elo = 20,
       mensagem = {
	   "Talk to Kakashi, he is waiting for you to leave on a mission in front of the South Gate of Konoha",
	   "Talk to Shikamaru to help you on this mission",
	   "Take the konoha path to South forest and find and Defeat Jiroubou;",
	   "Find and Defeat Kidomaru;",
	   "Find and Defeat Sakon;",
	   "Find and Defeat Tayuya;",
	   "Find and Defeat Kimimaro;",
	   "Proceed to the waterfall in the valley at the end, there you will find Sasuke, get ready for battle."
	   }},
	   
[9] = {capitulo = "Gaara Rescue", elo = 20,
       mensagem = {
	   "Talk to Tsunade in the Hokage building, a mission is waiting for you;",
	   "Talk to Grandma Chiyo, she is in front of the Kazekage building in SunaGakure No Sato;",
	   "Find and Defeat Sasori;",
	   "Find and Defeat Deidara;",
	   "Talk to grandma chiyo;",
	   "Healing Ninjutsu: Revive Gaara, press your body to transfer chakra to it."
	   }},
	   
[10] = {capitulo = "Orochimaru's new hideout", elo = 25,
       mensagem = {
	   "Find Sai, test your strength by fighting him;",
	   "Talk to Yamato who is near the konoha anbu barracks",
	   "Go to the Tenchi bridge to meet the spy located on lost island after SunaGakure no Sato",
	   "Chat with Kabuto Yakushi",
	   "Defeat the Orochimaru",
	   "Find Orochimaru's hideout",
	   "Find and Defeat Sasuke"
	   }},

[11] = {capitulo = "Akatsuki was found", elo = 25,
       mensagem = {
	   "Chat with Yamato",
	   "Defeat Hidan",
	   "Defeat Kakuzu"
	   }},

	   
[12] = {capitulo = "The rise of the hebi", elo = 40,
       mensagem = {
	   "Chat with Orochimaru",
	   "Defeat 1000 Ninjas",
	   "Defeat Orochimaru"
	   }},
	   
[13] = {capitulo = "Uchiha Ties", elo = 25,
       mensagem = {
	   "Follow the path to the old Uchiha base",
	   "Defeat Deidara",
	   "Defeat Itachi"
	   }},
	   
	   
[14] = {capitulo = "The host of 8 Tails", elo = 30,
       mensagem = {
	   "Look for Tobi, he's in hiding in South Forest",
	   "Go to KumoGakure and capture the 8 Tails",
	   "Defeat Hachibi"
	   }},
	   

[15] = {capitulo = "Destruction of konoha", elo = 40,
       mensagem = {
	   "Chat with Tsunade in the Hokage building",
	   "Chat with Fukasaku",
	   "Train in the Frog Statues",
	   "Chat with Fukasaku",
	   "Defeat the Gamabunta",
	   "Chat with Fukasaku",
	   "Pain destroyed konoha, defeat him",
	   "Chat with Nagato"
       }},	   
}


----------------------------- MONSTERS ------------------------
SAGASYSTEM.MONSTERS = {
-- ["Kakashi Sensei "] = {avance = true},
-- ["Kakashi Sensei  "] = {avance = true},
["Haku "] = {avance = true },
["Zabuza Momochi "] = {avance = true},
-- ["Orochimaru "] = {avance = false},
-- ["Gaara "] = {avance = false},
-- ["Temari "] = {avance = false},
-- ["Tenten "] = {avance = false},
-- ["Kankuro "] = {avance = false},
-- ["Neji "] = {avance = false},
-- ["Rock Lee "] = {avance = false},
["Temari  "] = {avance = true},
["Kankuro  "] = {avance = true},
["Gaara   "] = {avance = true},
["Kabuto  "] = {avance = true},
["Orochimaru  "] = {avance = true},
["Sasuke  "] = {avance = true, createnpc = {"ssasuke",{x= 2120, y=2065, z= 5}}},
["Jiroubou "] = {avance = true},
["Kidomaru "] = {avance = true},
["Sakon "] = {avance = true},
["Tayuya "] = {avance = true},
["Kimimaro "] = {avance = true},
["Uchiha Sasuke "] = {avance = true},
["Sasori "] = {avance = true, tp = {x= 2084, y=3917, z= 7}},
["Deidara "] = {avance = true},
["Sai"] = {avance = true},
["Orochimaru     "] = {avance = true, tp = {x= 1104, y=2647, z= 4}},
["Sasuke     "] = {avance = true},
["Hidan "] = {avance = true},
["Kakuzu  "] = {avance = true, tp = {x= 2012, y=2026, z= 7}},
["Orochimaru      "] = {avance = true, tp = {x= 1193, y=2645, z= 4}},
["Deidara     "] = {avance = true},
["    Itachi "] = {avance = true, tp = {x= 2077, y=2229, z= 7}},
["Killer Bee "] = {avance = true, tp = {x= 2550, y=1523, z= 6}},
["Hachibi "] = {avance = true, tp = {x= 2547, y=1518, z= 7}},
["Gamabunta "] = {avance = true},
["Pain "] = {avance = true, tp = {x= 1496, y=3961, z= 7}},
}


---------------------- NPCS ---------------------------
SAGASYSTEM.NPCS = {
["Iruka"] = {{0,1}},

["Mizuki"] = {{1,1}},

["Mizuki "] = {{1,4}},

["Iruka Sensei"] = {{1,5}},

["Kakashi"] = {{2,1,"I see that you became a genin recently to start doing missions you need to do a {training} first"},
               {5,1,"Did you notice %s? Gaara's chakra during the chunin exam was out of the ordinary, this can cause serious problems for the village, we need to {stop} it!"},
               {8,1,"Not this one!! Sasuke has been kidnapped and is being taken to the orochimaru lair! We need {to} them before they get there"}},

["III Hokage"] = {{3,1}},

["Tazuna"] = {{3,2}},

["Ibiki Morino"] = {{4,1}},

["Anko"] = {{4,2}},

["Examinador"] = {{4,6}},

["Jiraya"] = {{6,1}},

["Tsunade "] = {{6,2}},

["Sasuke"] = {{7,1}},

["Shikamaru"] = {{8,2}},

["Tsunade"] = {{9,1,"Hello %s I'm glad you came back, you have grown a lot, I hope you are ready for another {mission}."},
               {15,1,"Hello %s I'm sorry for Jiraya, we are all shaken by what happened, but we only have to, {move on}."}},

["Vovo Chiyo"] = {{9,2}},

["Vovo Chiyo "] = {{9,5}},

["Yamato"] = {{10,2,"Hello %s we discovered that there was a spy from Akatsuki, subordinate to Orochimaru. We have to {find out} who it is."},
              {11,1,"Good thing %s arrived on time, two members of {akatsuki} were spotted recently!"}},

["Kabuto Yakushi"] = {{10,4},{10,5}},

["Orochimaru"] = {{12,1} },

[" Tobi"] = {{14,1}},

["Fukasaku"] = {{15,2},{15,4}, {15,6}},

["Nagato"] = {{15,8}},
}

--------------------------------------------------------

SAGASYSTEM.RETURN = {
[2] = function(cid) 
                    setPlayerSaga(cid, 2, 1) 
                 end,
[4] = function(cid)
                    setPlayerSaga(cid, 4, 2)
                    setPlayerStorageValue(cid,39842, 0)
                    setPlayerStorageValue(cid,39843, 0)
                    doPlayerRemoveItem(cid, 12281, getPlayerItemCount(cid, 12281))
                    doPlayerRemoveItem(cid, 12282, getPlayerItemCount(cid, 12282))
				 end,
[9] = function(cid) 
                    setPlayerSaga(cid, 9, 2) 
                 end,
[11] = function(cid) 
                    setPlayerSaga(cid, 11, 1) 
					if getCreatureByName("kakuzu  ") then
                    doRemoveCreature(getCreatureByName("kakuzu  "))
                    end
                    if getCreatureByName("kakuzu ") then
                    doRemoveCreature(getCreatureByName("kakuzu "))
                    end
                    if getCreatureByName("hidan ") then
                    doRemoveCreature(getCreatureByName("hidan "))
                    end
                 end,
[13] = function(cid)
                    setPlayerSaga(cid, 13, 1)
                 end,
[14] = function(cid)
                    setPlayerSaga(cid, 14, 2)
                 end,
[15] = function(cid)
                    setPlayerStorageValue(cid, 192132,0)
                    setPlayerStorageValue(cid, 192133,0)
                    setPlayerSaga(cid, 15, 2)
                 end,
}
				 
				 
				 
SAGASTO = 40000

function storageSaga(saganumer)
return 40100+saganumer
end


function doPlayerAtualSaga(cid)
local c_info = getSagaInfo(cid)
local SAGAINFO = SAGASYSTEM.HISTORY[c_info.saga]
if getPlayerStorageValue(cid, SAGASTO) > 0 then
doPlayerPopupFYI(cid, string.format("[%d/%d] %s\n\n%s : %s", c_info.saga, #SAGASYSTEM.HISTORY, _TR(cid, SAGAINFO.capitulo), _TR(cid, "Mission"), _TR(cid, SAGAINFO.mensagem[c_info.missao])))
else
doPlayerPopupFYI(cid, "Talk to Iruka Sensei at Shinobi Academy to help you on your ninja path")
end
end

function doPlayerNextSaga(cid)
local c_info = getSagaInfo(cid)
setPlayerStorageValue(cid,storageSaga(c_info.saga), c_info.missao+1)
if SAGASYSTEM.HISTORY[c_info.saga].mensagem[c_info.missao+1] then
doPlayerAtualSaga(cid)
else
if SAGASYSTEM.HISTORY[c_info.saga] and SAGASYSTEM.HISTORY[c_info.saga].elo then
doPlayerAddEloPoints(cid, SAGASYSTEM.HISTORY[c_info.saga].elo )
doPlayerSendTextMessage(cid, MESSAGE_INFO_DESCR, string.format("%s%d %s.", _TR(cid, "You received "), SAGASYSTEM.HISTORY[c_info.saga].elo, _TR(cid, "elo points")))
end
c_info.saga = c_info.saga+1
setPlayerStorageValue(cid,SAGASTO, c_info.saga)
setPlayerStorageValue(cid,storageSaga(c_info.saga), 1)
return SAGASYSTEM.HISTORY[c_info.saga] and doPlayerPopupFYI(cid, string.format('     %s %i %s. \n ** %s ** \n            %s',_TR(cid, "Chapter"),c_info.saga+1, _TR(cid, "unlocked"),_TR(cid, SAGASYSTEM.HISTORY[c_info.saga].capitulo), (_TR(cid, 'talk "!saga"')))) or doPlayerPopupFYI(cid, "Você completou todas as sagas, aguarde por atualizações no sistema")
end
end

function doPlayerPrevSaga(cid)
local c_info = getSagaInfo(cid)
if c_info.missao == 1 then
c_info.saga = c_info.saga-1
if SAGASYSTEM.HISTORY[c_info.saga] and SAGASYSTEM.HISTORY[c_info.saga].elo then
doPlayerRemovePoints(cid, SAGASYSTEM.HISTORY[c_info.saga].elo)
doPlayerSendTextMessage(cid, MESSAGE_INFO_DESCR, string.format("%s%d %s.", _TR(cid, "You lose "), SAGASYSTEM.HISTORY[c_info.saga].elo, _TR(cid, "elo points")))
end
setPlayerStorageValue(cid,SAGASTO, c_info.saga)
setPlayerStorageValue(cid,storageSaga(c_info.saga), #SAGASYSTEM.HISTORY[c_info.saga].mensagem)
else
setPlayerStorageValue(cid,storageSaga(c_info.saga), c_info.missao-1)
end
end

function getSagaInfo(cid)
local id = getPlayerStorageValue(cid, SAGASTO)
return {saga = id, missao = getPlayerStorageValue(cid, storageSaga(id))}
end

function getPlayerSaga(cid, saga, missao)
if saga and getPlayerStorageValue(cid, SAGASTO) == saga then
    if missao then
	return getPlayerStorageValue(cid, storageSaga(saga)) == missao
    end
return true
end
return false
end

function setPlayerSaga(cid, saga, missao)
if saga then
setPlayerStorageValue(cid, SAGASTO, saga)
    if missao then
	setPlayerStorageValue(cid, storageSaga(saga), missao)
    end
end
return true
end



-- SAGASYSTEM.onKill = function(cid, target)
-- local tab = SAGASYSTEM.MONSTERS[getCreatureName(target)]
    -- if tab.avance then 
    -- doPlayerNextSaga(cid)
    -- end
----
    -- if tab.createnpc then
    -- doCreateNpc(tab.createnpc[1], tab.createnpc[2])
    -- end
----
----
    -- if tab.tp then
    -- doTeleportThing(cid, tab.tp)
    -- end
----
----
    -- if getCreatureName(target) == "Deidara " then
    -- local pos = getCreaturePosition(cid)
    -- doTeleportThing(cid, {x= pos.x+1, y=pos.y+1, z= 6})
    -- end
-- end

SAGASYSTEM.onDeath = function(player, monsterName)
local tab = SAGASYSTEM.MONSTERS[monsterName]
if tab then
    if tab.avance then 
    doPlayerNextSaga(player)
    end
    ------
    if tab.createnpc then
    doCreateNpc(tab.createnpc[1], tab.createnpc[2])
    end
    ------
    ------
    if tab.tp then
    doTeleportThing(player, tab.tp)
    end
    ------
    ------
    if monsterName == "Deidara " then
    local pos = getCreaturePosition(player)
    doTeleportThing(player, {x= pos.x+1, y=pos.y+1, z= 6})
    elseif monsterName == "    Itachi " then
    doPlayerAddItem(cid, 18554, 1)
    end
end
end