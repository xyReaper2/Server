<?xml version="1.0" encoding="ISO-8859-1"?> 
<mod name="Simple Task" version="4.0" author="Vodkart" contact="tibiaking.com" enabled="yes"> 
<config name="task_func"><![CDATA[
task_sys = {
	[1] = {name = "Mouse and Spider", start = 176201, monsters_list = {"mouse","spider"}, level = 8, count = 55, points = 1, items = {}, reward = {}, exp = 45000, money = 55000},
	[2] = {name = "Boxer and Bandit", start = 176202, monsters_list = {"boxer", "Bandit Sword"}, level = 30, count = 100, points = 2, items = {}, reward = {}, exp = 55000, money = 69750},
	[3] = {name = "Samurai", start = 176203, monsters_list = {"samurai"}, level = 100, count = 100, points = 3, items = {}, reward = {}, exp = 65000, money = 75000},
	[4] = {name = "Animal", start = 176204, monsters_list = {"tiger","bear"}, level = 150, count = 90, points = 4, items = {}, reward = {}, exp = 75000, money = 155720},
	[5] = {name = "Elder dragon", start = 176205, monsters_list = {"ribaiasan"}, level = 200, count = 200, points = 5, items = {}, reward = {{12635,1}}, exp = 85000, money = 175720},
	[6] = {name = "Xiang", start = 176206, monsters_list = {"xiang"}, level = 225, count = 250, points = 10, items = {}, reward = {{11080,1}, {12284,1}, {10493,1}}, exp = 95000, money = 181720},
	[7] = {name = "Snake", start = 176207, monsters_list = {"hebi", "ningen hebi", "hebi shiro"}, level = 250, count = 350, points = 12, items = {}, reward = {{16476,20}, {16474,20}, {10712,20}, {16475,20}}, exp = 105000, money = 221720},
	[8] = {name = "huntsman", start = 176208, monsters_list = {"huntsman"}, level = 275, count = 450, points = 15, items = {}, reward = {{17455,1}, {10364,50}, {10365,50}}, exp = 115000, money = 243520},
	[9] = {name = "anbu", start = 176209, monsters_list = {"anbu"}, level = 300, count = 650, points = 20, items = {}, reward = {{10203,1}, {10201,1}, {10199,1}}, exp = 125000, money = 323520},
	[10] = {name = "invocation", start = 176210, monsters_list = {"senjuu kyodaijya"}, level = 325, count = 750, points = 20, items = {}, reward = {{17456,1}, {17090,2}}, exp = 145000, money = 453520},
	[11] = {name = "konchu", start = 176211, monsters_list = {"konchu"}, level = 350, count = 950, points = 20, items = {}, reward = {{18554,1}, {17090,1}}, exp = 515000, money = 492920},
	[12] = {name = "yoshiaki", start = 176212, monsters_list = {"yoshiaki"}, level = 350, count = 1150, points = 25, items = {}, reward = {{11105,1}, {17090,1}}, exp = 815000, money = 611495},
	[13] = {name = "killer anbu", start = 176213, monsters_list = {"strong anbu", "serious anbu"}, level = 400, count = 1350, points = 35, items = {}, reward = {{18557,1}, {17090,1}}, exp = 1015000, money = 681495},
	[14] = {name = "Hard Monster", start = 176214, monsters_list = {"purple kyodaijya", "drasilla", "okami"}, level = 450, count = 1850, points = 35, items = {}, reward = {{5921,1}, {17090,1}}, exp = 2915000, money = 881495},
	[15] = {name = "Lendario", start = 176215, monsters_list = {"purple kyodaijya", "drasilla", "okami"}, level = 500, count = 1850, points = 35, items = {}, reward = {{11106,1}, {17090,2}}, exp = 4915000, money = 2454450},
}
daily_task = {
	[1] = {name = "Sound Shinobi" ,monsters_list = {"sound shinobi"}, count = 200, points = 10, reward = {}, exp = 4915000, money = 181720},
	[2] = {name = "Bear" ,monsters_list = {"bear"}, count = 200, points = 10, reward = {}, exp = 4915000, money = 181720},
	[3] = {name = "Karasu" ,monsters_list = {"karasu"}, count = 200, points = 10, reward = {}, exp = 4915000, money = 181720},
	[4] = {name = "Rukongai" ,monsters_list = {"rukongai"}, count = 200, points = 10, reward = {}, exp = 4915000, money = 181720},
	[5] = {name = "Nukenin" ,monsters_list = {"nukenin"}, count = 200, points = 10, reward = {}, exp = 4915000, money = 181720},
	
	[6] = {name = "Anbu" ,monsters_list = {"anbu"}, count = 300, points = 20, reward = {}, exp = 4915000, money = 181720},
	[7] = {name = "Ningen Hebi" ,monsters_list = {"ningen hebi"}, count = 300, points = 20, reward = {}, exp = 4915000, money = 181720},
	[8] = {name = "Salamander" ,monsters_list = {"salamander"}, count = 300, points = 20, reward = {}, exp = 4915000, money = 181720},
	[9] = {name = "Gen Zetsu" ,monsters_list = {"gen zetsu"}, count = 300, points = 20, reward = {}, exp = 4915000, money = 181720},
	
	[10] = {name = "Dino" ,monsters_list = {"dino"}, count = 300, points = 25, reward = {}, exp = 4915000, money = 181720},
	[11] = {name = "Vampire" ,monsters_list = {"vampire"}, count = 300, points = 25, reward = {}, exp = 4915000, money = 181720},
	[12] = {name = "Konchu" ,monsters_list = {"konchu"}, count = 300, points = 25, reward = {}, exp = 4915000, money = 181720},
	[13] = {name = "Yoshiaki" ,monsters_list = {"yoshiaki"}, count = 300, points = 25, reward = {}, exp = 4915000, money = 181720},
	[14] = {name = "Ootsuka" ,monsters_list = {"ootsuka"}, count = 300, points = 25, reward = {}, exp = 4915000, money = 181720},
	[15] = {name = "Sakurai" ,monsters_list = {"sakurai"}, count = 300, points = 25, reward = {}, exp = 4915000, money = 181720},
	
	[16] = {name = "Kaishan" ,monsters_list = {"kaishan"}, count = 260, points = 30, reward = {}, exp = 4915000, money = 181720},
	[17] = {name = "Shaman" ,monsters_list = {"shaman"}, count = 200, points = 30, reward = {}, exp = 4915000, money = 181720},
	[18] = {name = "Dragon Lord" ,monsters_list = {"dragon lord"}, count = 150, points = 30, reward = {}, exp = 4915000, money = 181720},
	[19] = {name = "Shurata" ,monsters_list = {"shurata"}, count = 180, points = 30, reward = {}, exp = 4915000, money = 181720},
	[20] = {name = "Scorpion" ,monsters_list = {"scorpion"}, count = 290, points = 30, reward = {}, exp = 4915000, money = 181720},
	[21] = {name = "Aracnideo" ,monsters_list = {"aracnideo"}, count = 150, points = 30, reward = {}, exp = 4915000, money = 181720},
	[22] = {name = "Hebi Shiro" ,monsters_list = {"hebi shiro"}, count = 300, points = 30, reward = {}, exp = 4915000, money = 181720},
	[23] = {name = "Storm" ,monsters_list = {"storm"}, count = 300, points = 30, reward = {}, exp = 4915000, money = 181720},
	[24] = {name = "Strong Anbu" ,monsters_list = {"strong anbu"}, count = 300, points = 30, reward = {}, exp = 4915000, money = 181720},
	[25] = {name = "Quimera" ,monsters_list = {"quimera"}, count = 300, points = 30, reward = {}, exp = 4915000, money = 181720},
	[26] = {name = "Okami" ,monsters_list = {"okami"}, count = 300, points = 30, reward = {}, exp = 4915000, money = 181720},
	[27] = {name = "Purple Kyodaijya" ,monsters_list = {"purple kyodaijya"}, count = 290, points = 30, reward = {}, exp = 4915000, money = 181720},
	[28] = {name = "Susumo" ,monsters_list = {"susumo"}, count = 310, points = 30, reward = {}, exp = 4915000, money = 181720},
	[29] = {name = "Genetic Shin" ,monsters_list = {"genetic shin"}, count = 280, points = 30, reward = {}, exp = 4915000, money = 181720},
	[30] = {name = "Unknow" ,monsters_list = {"Unknow"}, count = 350, points = 30, reward = {}, exp = 4915000, money = 181720},
	
	[31] = {name = "Dashou Kaishan" ,monsters_list = {"dashou kaishan"}, count = 400, points = 40, reward = {}, exp = 12915000, money = 2969450},
	[32] = {name = "Shurata" ,monsters_list = {"shurata"}, count = 400, points = 40, reward = {}, exp = 12915000, money = 2969450},
	[33] = {name = "Devil Skeleton" ,monsters_list = {"devil skeleton"}, count = 400, points = 40, reward = {}, exp = 12915000, money = 2969450},
	[34] = {name = "Wyda" ,monsters_list = {"wyda"}, count = 400, points = 40, reward = {}, exp = 12915000, money = 2969450},
	[35] = {name = "Aracnideo" ,monsters_list = {"aracnideo"}, count = 400, points = 40, reward = {}, exp = 12915000, money = 2969450},
	[36] = {name = "Unknow" ,monsters_list = {"unknow"}, count = 400, points = 40, reward = {}, exp = 12915000, money = 2969450},
	[37] = {name = "Ice Worm" ,monsters_list = {"ice worm"}, count = 400, points = 40, reward = {}, exp = 12915000, money = 2969450},
	[38] = {name = "Shinobi Spy" ,monsters_list = {"shinobi spy"}, count = 400, points = 40, reward = {}, exp = 12915000, money = 2969450},
	[39] = {name = "Susumo" ,monsters_list = {"susumo"}, count = 400, points = 40, reward = {}, exp = 12915000, money = 2969450},
	[40] = {name = "Diablo" ,monsters_list = {"diablo"}, count = 400, points = 40, reward = {}, exp = 12915000, money = 2969450},
	[41] = {name = "Dragon Lord" ,monsters_list = {"dragon lord"}, count = 400, points = 40, reward = {}, exp = 12915000, money = 2969450},
	[42] = {name = "Serious Anbu" ,monsters_list = {"serious anbu"}, count = 400, points = 40, reward = {}, exp = 12915000, money = 2969450},
	[43] = {name = "Alado" ,monsters_list = {"alado"}, count = 400, points = 40, reward = {}, exp = 12915000, money = 2969450},
	[44] = {name = "Master Samurai" ,monsters_list = {"master samurai"}, count = 400, points = 40, reward = {}, exp = 12915000, money = 2969450},
	[45] = {name = "Tsuyoi Kyojin" ,monsters_list = {"tsuyoi kyojin"}, count = 400, points = 40, reward = {}, exp = 12915000, money = 2969450},
	[46] = {name = "Okami" ,monsters_list = {"okami"}, count = 400, points = 40, reward = {}, exp = 12915000, money = 2969450},
	[47] = {name = "Alado" ,monsters_list = {"Alado"}, count = 400, points = 40, reward = {}, exp = 12915000, money = 2969450},

}
task_sys_storages = {176601, 176602, 176603, 176604, 176605, 176606, 176607, 176608} -- task, points, count, daily task, daily count, daily time , daily start, contador
function getTaskMission(cid)
	return getPlayerStorageValue(cid,task_sys_storages[1]) < 0 and 1 or getPlayerStorageValue(cid,task_sys_storages[1])
end
function getDailyTaskMission(cid)
	return getPlayerStorageValue(cid,task_sys_storages[4]) < 0 and 1 or getPlayerStorageValue(cid,task_sys_storages[4])
end
function getTaskPoints(cid)
	return getPlayerStorageValue(cid,task_sys_storages[2]) < 0 and 0 or getPlayerStorageValue(cid,task_sys_storages[2])
end
function doRandomDailyTask(cid)
	local t = {
		[{1,200}] = {1,5},
		[{201,300}] = {6,9},
		[{301,400}] = {10,15},
		[{401,500}] = {16,30},
		[{501,math.huge}] = {31,47}
	}
	for a , b in pairs(t) do
		if getPlayerLevel(cid) >= a[1] and getPlayerLevel(cid) <= a[2] then
			return math.random(b[1], b[2])
		end
	end
	return 0
end
function GetRankTask(cid)
	local ranks = {
		[{1, 20}] = "Huntsman", 
		[{21, 50}] = "Ranger",
		[{51, 100}] = "Big Game Hunter",
		[{101, 200}] = "Trophy Hunter",		
		[{201, math.huge}] = "Elite Hunter"
	}
	for v , r in pairs(ranks) do
		if getTaskPoints(cid) >= v[1] and getTaskPoints(cid) <= v[2] then
			return r
		end
	end
	return 0
end
function getItemsFromList(items)
	local str = ''
	if table.maxn(items) > 0 then
		for i = 1, table.maxn(items) do
			str = str .. items[i][2] .. ' ' .. getItemNameById(items[i][1])
			if i ~= table.maxn(items) then str = str .. ', ' 
			end 
		end 
	end
	return str
end
function doRemoveItemsFromList(cid,items)
	local count = 0
	if table.maxn(items) > 0 then
		for i = 1, table.maxn(items) do
			if getPlayerItemCount(cid,items[i][1]) >= items[i][2] then
			count = count + 1 end 
		end 
	end
	if count == table.maxn(items) then
		for i = 1, table.maxn(items) do doPlayerRemoveItem(cid,items[i][1],items[i][2]) end
	else 
		return false 
	end
	return true 
end
function getMonsterFromList(monster)
	local str = ''
	if #monster > 0 then
		for i = 1, #monster do
			str = str .. monster[i]
			if i ~= #monster then str = str .. ', ' end
		end 
	end
	return str
end
function GiveRewardsTask(cid, items)
	local backpack = doPlayerAddItem(cid, 1999, 1) -- backpackID
	for _, i_i in ipairs(items) do
		local item, amount = i_i[1],i_i[2]
		if isItemStackable(item) or amount == 1 then
			doAddContainerItem(backpack, item, amount)
		else
			for i = 1, amount do
				doAddContainerItem(backpack, item, 1)
			end
		end
	end
end
function isSummon(cid)
	if(not isCreature(cid)) then
		return false
	end
	return getCreatureMaster(cid) ~= cid
end
]]></config>
<event type="login" name="TaskLogin" event="script"><![CDATA[
function onLogin(cid)
	registerCreatureEvent(cid, "KillTask")
	registerCreatureEvent(cid, "TaskLook")
	return true
end]]></event>
<talkaction words="/task;!task" event="buffer"><![CDATA[
domodlib('task_func')
param,task,daily = param:lower(), getTaskMission(cid), getDailyTaskMission(cid)
if isInArray({"counter","contador"},param) then
	setPlayerStorageValue(cid, task_sys_storages[8], getPlayerStorageValue(cid, task_sys_storages[8]) <= 0 and 1 or 0)
	doPlayerSendTextMessage(cid, MESSAGE_STATUS_CONSOLE_BLUE,"[Task System] O contador foi "..(getPlayerStorageValue(cid, task_sys_storages[8]) <= 0 and "ativado" or "desativado")..".") return true
elseif isInArray({"daily","diaria"},param) then
	if not daily_task[daily] or getPlayerStorageValue(cid, task_sys_storages[7]) <= 0 then
		doPlayerSendCancel(cid, "Desculpe, Mas voceª naoo estÃ¡ em nenhuma Daily Task.") return true
	elseif getPlayerStorageValue(cid, task_sys_storages[6]) - os.time() <= 0 and getPlayerStorageValue(cid, task_sys_storages[5]) < daily_task[daily].count then
		doPlayerSendCancel(cid,"Desculpe, Mas Voce nao terminou a Daily Task a tempo! Por favor volte ao npc e comece uma nova Daily Task!") return true
	end
	return doShowTextDialog(cid, 8983, "[->] CURRENT DAILY TASK INFO [<-]\n\nNome: "..daily_task[daily].name.."\nProgresso: ["..(getPlayerStorageValue(cid, task_sys_storages[5]) < 0 and 0 or getPlayerStorageValue(cid, task_sys_storages[5])).."/"..daily_task[daily].count.."]\nPrazo para entrega: "..os.date("%d %B %Y %X ", getPlayerStorageValue(cid,task_sys_storages[6])).."\nMonstros para caÃ§ar: "..getMonsterFromList(daily_task[daily].monsters_list).."\n\n[->] CURRENT TASK REWARDS [<-]\n\nMoney: "..(daily_task[daily].money > 0 and daily_task[daily].money or 0).."\nExperiencia: "..(daily_task[daily].exp > 0 and daily_task[daily].exp or 0).."\nTask Points: "..daily_task[daily].points.."\nItems: "..(#daily_task[daily].reward > 0 and getItemsFromList(daily_task[daily].reward) or "Nenhum item de recompensa")..".")
end
if not task_sys[task] or getPlayerStorageValue(cid, task_sys[task].start) <= 0 then
	doPlayerSendCancel(cid, "vocÃª nÃ£o estÃ¡ em nenhuma task.") return true
end 
return doShowTextDialog(cid, 8983, "-> CURRENT TASK ["..getTaskMission(cid).."/"..#task_sys.."] <-\n\nTask Name: "..task_sys[task].name.."\nTask Level: "..task_sys[task].level.."\nTask Progress: ["..(getPlayerStorageValue(cid, task_sys_storages[3]) < 0 and 0 or getPlayerStorageValue(cid, task_sys_storages[3])).."/"..task_sys[task].count.."]\nMonster To Hunt: "..getMonsterFromList(task_sys[task].monsters_list)..".\nItens Para Entrega: "..(#task_sys[task].items > 0 and getItemsFromList(task_sys[task].items) or "Nenhum")..".\n\n[->] CURRENT TASK REWARDS [<-]\n\nReward Money: "..(task_sys[task].money > 0 and task_sys[task].money or 0).."\nReward Experiencia: "..(task_sys[task].exp > 0 and task_sys[task].exp or 0).."\nReward Points: "..task_sys[task].points.."\nRedward Items: "..(#task_sys[task].reward > 0 and getItemsFromList(task_sys[task].reward) or "Nenhum item de recompensa")..".")
]]></talkaction>
<event type="look" name="TaskLook" event="script"><![CDATA[
domodlib('task_func')
function onLook(cid, thing, position, lookDistance)
	if isPlayer(thing.uid) and getTaskPoints(thing.uid) > 0 then
		doPlayerSetSpecialDescription(thing.uid, "\n"..(getPlayerSex(thing.uid) == 0 and "She" or "He").. " is a "..GetRankTask(thing.uid))
	end	
	return true
end]]></event> 
<event type="kill" name="KillTask" event="script"><![CDATA[
domodlib('task_func')
function onKill(cid, target)
	if isPlayer(cid) and isMonster(target) then
		local t,daily = task_sys[getTaskMission(cid)], daily_task[getDailyTaskMission(cid)]
		if t and getPlayerStorageValue(cid, t.start) > 0 and isInArray(t.monsters_list, getCreatureName(target):lower()) and getPlayerStorageValue(cid, task_sys_storages[3]) < t.count then
			setPlayerStorageValue(cid, task_sys_storages[3], getPlayerStorageValue(cid, task_sys_storages[3]) < 0 and 1 or (getPlayerStorageValue(cid, task_sys_storages[3])+1))
			if getPlayerStorageValue(cid, task_sys_storages[8]) <= 0 and getPlayerStorageValue(cid, task_sys_storages[3]) < t.count then
				doPlayerSendTextMessage(cid, MESSAGE_STATUS_CONSOLE_ORANGE,"[Task System] defeated Total [" .. getPlayerStorageValue(cid, task_sys_storages[3]) .. "/" .. t.count .. "] da Task do " .. t.name .. ".")
			end
			if getPlayerStorageValue(cid, task_sys_storages[3]) >= t.count then
				doPlayerSendTextMessage(cid, MESSAGE_STATUS_CONSOLE_ORANGE,"[Task System] ParabÃ©ns! VocÃª terminou a Task do "..t.name..", volte ao npc parece receber sua recompensa.")
			end
		end
		if daily and getPlayerStorageValue(cid, task_sys_storages[7]) > 0 and getPlayerStorageValue(cid, task_sys_storages[6]) - os.time() >= 0 and isInArray(daily.monsters_list, getCreatureName(target):lower()) and getPlayerStorageValue(cid, task_sys_storages[5]) < daily.count then
			setPlayerStorageValue(cid, task_sys_storages[5], getPlayerStorageValue(cid, task_sys_storages[5]) < 0 and 1 or (getPlayerStorageValue(cid, task_sys_storages[5])+1))
			if getPlayerStorageValue(cid, task_sys_storages[8]) <= 0 and getPlayerStorageValue(cid, task_sys_storages[5]) < daily.count then
				doPlayerSendTextMessage(cid, MESSAGE_STATUS_CONSOLE_BLUE,"[Daily Task System] defeated Total [" .. getPlayerStorageValue(cid, task_sys_storages[5]) .. "/" .. daily.count .. "] da Task do " .. daily.name .. ".")
			end
			if getPlayerStorageValue(cid, task_sys_storages[5]) >= daily.count then
				doPlayerSendTextMessage(cid, MESSAGE_STATUS_CONSOLE_ORANGE,"[Daily Task System] ParabÃ©ns! VocÃª terminou a Task do "..daily.name..", volte ao npc parece receber sua recompensa.")
			end
		end 
	end
	return true
end]]></event>
</mod>